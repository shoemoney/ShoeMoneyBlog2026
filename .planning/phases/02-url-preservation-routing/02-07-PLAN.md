---
phase: 02-url-preservation-routing
plan: 07
type: execute
wave: 4
depends_on: ["02-04", "02-05", "02-06"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All routes return expected responses"
    - "URL verification passes 100%"
    - "Sitemap contains all content"
    - "Trailing slash redirects work"
  artifacts: []
  key_links: []
---

<objective>
Final verification of Phase 2 URL preservation and routing.

Purpose: Confirm all success criteria are met before proceeding to Phase 3 (Public Content Display).
Output: Verified working URL routing, sitemap, and verification command
</objective>

<execution_context>
@/Users/shoemoney/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shoemoney/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-url-preservation-routing/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run comprehensive URL verification</name>
  <files></files>
  <action>
Execute the full URL verification command:

```bash
# Ensure server is running
php artisan serve --port=8000 &
sleep 2

# Run full verification (may take several minutes with 3,870 posts)
php artisan urls:verify --base-url=http://localhost:8000

# If the above is too slow, verify samples from each type
php artisan urls:verify --type=posts --limit=100
php artisan urls:verify --type=pages --limit=50
php artisan urls:verify --type=categories
php artisan urls:verify --type=tags --limit=500
```

Record the results. If any failures, investigate and note in SUMMARY.
  </action>
  <verify>Command output shows 100% success rate or explains any legitimate failures (e.g., draft content)</verify>
  <done>URL verification completed, results documented</done>
</task>

<task type="auto">
  <name>Task 2: Verify sitemap generation and content</name>
  <files></files>
  <action>
Generate and validate sitemap:

```bash
# Generate fresh sitemap
php artisan sitemap:generate

# Check sitemap exists and has content
ls -la public/sitemap.xml
wc -l public/sitemap.xml

# Verify sitemap is accessible
curl -I http://localhost:8000/sitemap.xml

# Spot check sitemap content
head -100 public/sitemap.xml
grep -c "<url>" public/sitemap.xml

# Validate XML structure (if xmllint available)
xmllint --noout public/sitemap.xml 2>&1 || echo "xmllint not available"
```

Record URL count and verify it matches expected content count.
  </action>
  <verify>Sitemap contains expected number of URLs (~3,870 posts + 159 pages + 14 categories + tags)</verify>
  <done>Sitemap generated with all content, accessible at /sitemap.xml</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete URL preservation routing system:
1. WordPress-compatible routes for posts, pages, categories, tags
2. Controllers with proper model lookups and 404 handling
3. Sitemap generation with all content
4. URL verification command
5. Trailing slash enforcement via 301 redirects
  </what-built>
  <how-to-verify>
1. Start server: `php artisan serve`

2. Test a sample post URL (get one from database):
   ```bash
   php artisan tinker --execute="echo App\Models\Post::published()->first()?->url"
   ```
   Visit that URL in browser - should return JSON with post data

3. Test category URL: Visit `/category/` + any category slug
   - Should return category info with post list

4. Test page URL: Visit `/` + any page slug
   - Should return page info

5. Test trailing slash redirect:
   - Visit a URL WITHOUT trailing slash (e.g., `/category/marketing`)
   - Should redirect to version WITH trailing slash

6. Test sitemap: Visit `/sitemap.xml`
   - Should display XML with all URLs

7. Run URL verification: `php artisan urls:verify --quick`
   - Should show 100% pass rate
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 2 Success Criteria Checklist:
1. [ ] Original WordPress post URLs load successfully (e.g., `/2015/08/how-i-made-money/` works)
2. [ ] Category and tag archive URLs match WordPress structure (`/category/marketing/`, `/tag/seo/`)
3. [ ] Automated URL verification script confirms 100% of exported WordPress URLs resolve without 404s
4. [ ] Sitemap.xml generated and accessible at `/sitemap.xml` with all published content
5. [ ] Any legacy URL variations redirect to canonical versions with 301 status codes
</verification>

<success_criteria>
All Phase 2 success criteria verified and documented. Ready to proceed to Phase 3.
</success_criteria>

<output>
After completion, create `.planning/phases/02-url-preservation-routing/02-07-SUMMARY.md`
</output>
