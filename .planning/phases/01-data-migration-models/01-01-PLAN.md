---
phase: 01-data-migration-models
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - config/database.php
  - .env.example
  - app/Models/WordPress/WpPost.php
  - app/Models/WordPress/WpUser.php
  - app/Models/WordPress/WpComment.php
  - app/Models/WordPress/WpTerm.php
  - app/Models/WordPress/WpTermTaxonomy.php
  - app/Models/WordPress/WpTermRelationship.php
  - app/Models/WordPress/WpPostMeta.php
autonomous: true

must_haves:
  truths:
    - "Laravel can connect to WordPress database and read wp2_posts table"
    - "WordPress models can query posts, users, comments, and taxonomy data"
    - "WordPress table relationships work (post -> terms, post -> meta)"
  artifacts:
    - path: "config/database.php"
      provides: "WordPress database connection"
      contains: "'wordpress' =>"
    - path: "app/Models/WordPress/WpPost.php"
      provides: "WordPress post model"
      contains: "protected $connection = 'wordpress'"
    - path: "app/Models/WordPress/WpTerm.php"
      provides: "WordPress term model"
      contains: "class WpTerm"
  key_links:
    - from: "app/Models/WordPress/WpPost.php"
      to: "app/Models/WordPress/WpTermTaxonomy.php"
      via: "belongsToMany through term_relationships"
      pattern: "belongsToMany.*WpTermTaxonomy"
    - from: "app/Models/WordPress/WpPost.php"
      to: "app/Models/WordPress/WpPostMeta.php"
      via: "hasMany meta relationship"
      pattern: "hasMany.*WpPostMeta"
---

<objective>
Configure multi-database connections and create read-only WordPress models for data migration.

Purpose: Establishes the source data access layer. Without this, seeders cannot read WordPress data.
Output: Working WordPress database connection + 7 Eloquent models for reading WordPress tables.
</objective>

<execution_context>
@/Users/shoemoney/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shoemoney/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-data-migration-models/01-RESEARCH.md

# WordPress database facts:
# - Database: shoemoney_wp
# - Table prefix: wp2_
# - Posts: 3,870 published
# - Comments: 160,569 approved
# - Users: 12
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure WordPress Database Connection</name>
  <files>
    config/database.php
    .env.example
  </files>
  <action>
Add WordPress database connection to config/database.php in the 'connections' array, after the existing 'mysql' connection:

```php
'wordpress' => [
    'driver' => 'mysql',
    'host' => env('WP_DB_HOST', '127.0.0.1'),
    'port' => env('WP_DB_PORT', '3306'),
    'database' => env('WP_DB_DATABASE', 'shoemoney_wp'),
    'username' => env('WP_DB_USERNAME', 'root'),
    'password' => env('WP_DB_PASSWORD', ''),
    'unix_socket' => env('WP_DB_SOCKET', ''),
    'charset' => 'utf8mb4',
    'collation' => 'utf8mb4_unicode_ci',
    'prefix' => 'wp2_',
    'strict' => false, // WordPress uses non-strict mode
],
```

Update .env.example to add WordPress database variables after the main DB variables:

```
WP_DB_HOST=127.0.0.1
WP_DB_PORT=3306
WP_DB_DATABASE=shoemoney_wp
WP_DB_USERNAME=root
WP_DB_PASSWORD=
```

Note: strict=false is intentional - WordPress database may have data that fails MySQL strict mode.
  </action>
  <verify>
Run: `php artisan tinker --execute="DB::connection('wordpress')->getPdo(); echo 'WordPress connection OK';"` should output "WordPress connection OK" (requires user to have WP_DB vars in .env)
  </verify>
  <done>
WordPress database connection configured in config/database.php and .env.example documents required variables.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WordPress Read-Only Models</name>
  <files>
    app/Models/WordPress/WpPost.php
    app/Models/WordPress/WpUser.php
    app/Models/WordPress/WpComment.php
    app/Models/WordPress/WpTerm.php
    app/Models/WordPress/WpTermTaxonomy.php
    app/Models/WordPress/WpTermRelationship.php
    app/Models/WordPress/WpPostMeta.php
  </files>
  <action>
Create directory: `app/Models/WordPress/`

Create 7 models using the wordpress connection. All models are READ-ONLY (no writes to WordPress).

**WpPost.php:**
- Connection: wordpress
- Table: posts (prefix applied automatically)
- Primary key: ID (uppercase - WordPress convention)
- No timestamps (WordPress uses post_date, post_modified)
- Relationships:
  - meta(): hasMany(WpPostMeta::class, 'post_id', 'ID')
  - author(): belongsTo(WpUser::class, 'post_author', 'ID')
  - termTaxonomies(): belongsToMany(WpTermTaxonomy::class, 'term_relationships', 'object_id', 'term_taxonomy_id', 'ID', 'term_taxonomy_id')
  - comments(): hasMany(WpComment::class, 'comment_post_ID', 'ID')
- Scopes:
  - scopePublished(): where('post_status', 'publish')
  - scopePosts(): where('post_type', 'post')
  - scopePages(): where('post_type', 'page')

**WpUser.php:**
- Connection: wordpress
- Table: users
- Primary key: ID
- No timestamps
- Relationships:
  - posts(): hasMany(WpPost::class, 'post_author', 'ID')

**WpComment.php:**
- Connection: wordpress
- Table: comments
- Primary key: comment_ID
- No timestamps (uses comment_date)
- Relationships:
  - post(): belongsTo(WpPost::class, 'comment_post_ID', 'ID')
  - parent(): belongsTo(WpComment::class, 'comment_parent', 'comment_ID')
  - replies(): hasMany(WpComment::class, 'comment_parent', 'comment_ID')
- Scopes:
  - scopeApproved(): where('comment_approved', '1')

**WpTerm.php:**
- Connection: wordpress
- Table: terms
- Primary key: term_id
- No timestamps
- Relationships:
  - taxonomy(): hasOne(WpTermTaxonomy::class, 'term_id', 'term_id')

**WpTermTaxonomy.php:**
- Connection: wordpress
- Table: term_taxonomy
- Primary key: term_taxonomy_id
- No timestamps
- Relationships:
  - term(): belongsTo(WpTerm::class, 'term_id', 'term_id')
  - posts(): belongsToMany(WpPost::class, 'term_relationships', 'term_taxonomy_id', 'object_id', 'term_taxonomy_id', 'ID')
- Scopes:
  - scopeCategories(): where('taxonomy', 'category')
  - scopeTags(): where('taxonomy', 'post_tag')

**WpTermRelationship.php:**
- Connection: wordpress
- Table: term_relationships
- No primary key (composite)
- No timestamps

**WpPostMeta.php:**
- Connection: wordpress
- Table: postmeta
- Primary key: meta_id
- No timestamps
- Relationships:
  - post(): belongsTo(WpPost::class, 'post_id', 'ID')

Use the Laravel 12 attribute syntax. Do NOT use deprecated get{Attribute}Attribute() methods.
  </action>
  <verify>
Run these tinker commands to verify models work:

```bash
php artisan tinker --execute="echo 'Posts: ' . App\Models\WordPress\WpPost::published()->posts()->count();"
php artisan tinker --execute="echo 'Pages: ' . App\Models\WordPress\WpPost::published()->pages()->count();"
php artisan tinker --execute="echo 'Users: ' . App\Models\WordPress\WpUser::count();"
php artisan tinker --execute="echo 'Comments: ' . App\Models\WordPress\WpComment::approved()->count();"
php artisan tinker --execute="echo 'Categories: ' . App\Models\WordPress\WpTermTaxonomy::categories()->count();"
php artisan tinker --execute="echo 'Tags: ' . App\Models\WordPress\WpTermTaxonomy::tags()->count();"
```

Expected: Posts ~3870, Pages ~159, Users 12, Comments ~160569, Categories 14, Tags 15448
  </verify>
  <done>
Seven WordPress models created with correct connections, relationships, and scopes. Models can read all WordPress data needed for migration.
  </done>
</task>

</tasks>

<verification>
1. `php artisan config:show database.connections.wordpress` shows WordPress connection config
2. WordPress model queries return expected counts matching provided data
3. Relationship traversal works: `WpPost::first()->author->display_name` returns author name
4. Term relationships work: `WpPost::first()->termTaxonomies()->count()` returns > 0
</verification>

<success_criteria>
- WordPress database connection configured and working
- All 7 WordPress models created with appropriate relationships
- Query counts match expected: ~3870 posts, ~159 pages, 12 users, ~160569 comments
- Models are read-only (no $fillable, no write methods)
</success_criteria>

<output>
After completion, create `.planning/phases/01-data-migration-models/01-01-SUMMARY.md`
</output>
