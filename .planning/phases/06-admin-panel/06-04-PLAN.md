---
phase: 06-admin-panel
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - app/Livewire/Admin/Comments/CommentModeration.php
  - resources/views/livewire/admin/comments/comment-moderation.blade.php
  - routes/web.php
autonomous: true

must_haves:
  truths:
    - "Admin can see list of pending comments"
    - "Admin can filter comments by status (pending/approved/spam)"
    - "Admin can approve a pending comment"
    - "Admin can reject (mark as spam) a comment"
    - "Admin can delete a comment permanently"
  artifacts:
    - path: "app/Livewire/Admin/Comments/CommentModeration.php"
      provides: "Comment moderation with approve/reject/delete actions"
      contains: "approve"
    - path: "resources/views/livewire/admin/comments/comment-moderation.blade.php"
      provides: "Comment queue UI with action buttons"
      contains: "wire:click"
  key_links:
    - from: "app/Livewire/Admin/Comments/CommentModeration.php"
      to: "App\\Models\\Comment"
      via: "status update and delete"
      pattern: "Comment.*update|delete"
---

<objective>
Create comment moderation interface for approving, rejecting, and deleting comments.

Purpose: Enable admin to manage the 160K+ comments migrated from WordPress, focusing on the pending queue and spam management.

Output: CommentModeration Livewire component with status filtering and bulk-like actions.
</objective>

<execution_context>
@/Users/shoemoney/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shoemoney/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-admin-panel/06-RESEARCH.md
@app/Models/Comment.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CommentModeration component</name>
  <files>
    app/Livewire/Admin/Comments/CommentModeration.php
    resources/views/livewire/admin/comments/comment-moderation.blade.php
    routes/web.php
  </files>
  <action>
1. Create CommentModeration component at app/Livewire/Admin/Comments/CommentModeration.php:
   ```php
   <?php

   namespace App\Livewire\Admin\Comments;

   use App\Models\Comment;
   use Livewire\Attributes\Layout;
   use Livewire\Attributes\Title;
   use Livewire\Component;
   use Livewire\WithPagination;

   #[Layout('components.admin.layouts.app')]
   #[Title('Comment Moderation')]
   class CommentModeration extends Component
   {
       use WithPagination;

       public string $status = 'pending';

       public function updatingStatus(): void
       {
           $this->resetPage();
       }

       public function approve(Comment $comment): void
       {
           $comment->update(['status' => 'approved']);
           session()->flash('success', 'Comment approved.');
       }

       public function reject(Comment $comment): void
       {
           $comment->update(['status' => 'spam']);
           session()->flash('success', 'Comment marked as spam.');
       }

       public function delete(Comment $comment): void
       {
           $comment->delete();
           session()->flash('success', 'Comment deleted permanently.');
       }

       public function render()
       {
           return view('livewire.admin.comments.comment-moderation', [
               'comments' => Comment::query()
                   ->with(['post:id,title,slug,published_at'])
                   ->where('status', $this->status)
                   ->orderBy('created_at', 'desc')
                   ->paginate(20),
               'counts' => [
                   'pending' => Comment::pending()->count(),
                   'approved' => Comment::approved()->count(),
                   'spam' => Comment::where('status', 'spam')->count(),
               ],
           ]);
       }
   }
   ```

2. Create view at resources/views/livewire/admin/comments/comment-moderation.blade.php:
   - Header: "Comment Moderation" title
   - Status tabs/buttons (Pending, Approved, Spam) with counts in badges
   - Wire:click to change $status property
   - Active tab highlighted

   - For each comment, show card with:
     - Author name and email (with Gravatar if you like)
     - Comment content (truncated with "show more" if long)
     - Post title (link to frontend post)
     - Date submitted
     - Action buttons based on status:
       - Pending: Approve (green), Reject (red), Delete (gray)
       - Approved: Move to Spam, Delete
       - Spam: Approve, Delete

   - Use wire:click for approve/reject, wire:click with wire:confirm for delete
   - Pagination at bottom

3. Add route to web.php admin group:
   ```php
   Route::get('/comments', \App\Livewire\Admin\Comments\CommentModeration::class)->name('admin.comments.index');
   ```

Styling: Cards for each comment, subtle colors, clear action buttons.
  </action>
  <verify>
    php artisan livewire:list | grep CommentModeration
    php artisan route:list --path=admin/comments
  </verify>
  <done>
    - CommentModeration lists comments filtered by status
    - Status tabs show counts
    - Approve changes status to 'approved'
    - Reject changes status to 'spam'
    - Delete removes comment with confirmation
    - Pagination works for large comment sets
  </done>
</task>

</tasks>

<verification>
- [ ] /admin/comments shows pending comments by default
- [ ] Status tabs switch between pending/approved/spam
- [ ] Badge counts are accurate
- [ ] Approve button moves comment to approved status
- [ ] Reject button moves comment to spam status
- [ ] Delete button removes comment (with confirmation)
- [ ] Post title links to frontend post
- [ ] Pagination handles 20 comments per page
</verification>

<success_criteria>
1. Admin can view pending comments queue
2. Admin can filter by status (pending/approved/spam)
3. Admin can approve comments (changes status)
4. Admin can reject comments (marks as spam)
5. Admin can delete comments permanently
6. Counts update after actions
7. Large comment sets paginate correctly
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-panel/06-04-SUMMARY.md`
</output>
