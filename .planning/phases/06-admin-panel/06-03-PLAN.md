---
phase: 06-admin-panel
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - app/Livewire/Admin/Posts/PostIndex.php
  - resources/views/livewire/admin/posts/post-index.blade.php
  - app/Livewire/Admin/Posts/PostCreate.php
  - resources/views/livewire/admin/posts/post-create.blade.php
  - app/Livewire/Admin/Posts/PostEdit.php
  - resources/views/livewire/admin/posts/post-edit.blade.php
  - routes/web.php
autonomous: true

must_haves:
  truths:
    - "Admin can see list of all posts with search/filter"
    - "Admin can create a new post with title, content, and status"
    - "Admin can edit an existing post"
    - "Admin can publish/unpublish a post"
    - "Admin can delete a post with confirmation"
  artifacts:
    - path: "app/Livewire/Admin/Posts/PostIndex.php"
      provides: "Post listing with pagination and search"
      contains: "WithPagination"
    - path: "app/Livewire/Admin/Posts/PostCreate.php"
      provides: "Post creation form"
      contains: "save"
    - path: "app/Livewire/Admin/Posts/PostEdit.php"
      provides: "Post editing form"
      contains: "update"
  key_links:
    - from: "app/Livewire/Admin/Posts/PostIndex.php"
      to: "App\\Models\\Post"
      via: "Eloquent query in render()"
      pattern: "Post::query"
    - from: "app/Livewire/Admin/Posts/PostCreate.php"
      to: "App\\Models\\Post"
      via: "Post::create()"
      pattern: "Post::create"
---

<objective>
Create complete post management functionality: list, create, edit, delete.

Purpose: Enable admin to manage all blog posts including creation with rich text content, editing, publishing, and deletion.

Output: Three Livewire components (PostIndex, PostCreate, PostEdit) with full CRUD functionality.
</objective>

<execution_context>
@/Users/shoemoney/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shoemoney/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-admin-panel/06-RESEARCH.md
@app/Models/Post.php
@app/Models/Category.php
@app/Models/Tag.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PostIndex component with search and pagination</name>
  <files>
    app/Livewire/Admin/Posts/PostIndex.php
    resources/views/livewire/admin/posts/post-index.blade.php
    routes/web.php
  </files>
  <action>
1. Create PostIndex component:
   - Use WithPagination trait
   - Properties: $search (string), $status (string filter)
   - updatingSearch() and updatingStatus() call resetPage()
   - Query: Post::with('author')->when() for filters, orderBy published_at desc, paginate(15)
   - delete() method with wire:confirm for deletion

2. Create post-index.blade.php view:
   - Header with "Posts" title and "New Post" button linking to admin.posts.create
   - Search input with wire:model.live.debounce.300ms="search"
   - Status filter dropdown (All, Published, Draft)
   - Table with columns: Title, Author, Status, Date, Actions
   - Status badges (green for published, yellow for draft)
   - Action buttons: Edit (link), Delete (wire:click with wire:confirm)
   - Pagination links at bottom

3. Add route to web.php admin group:
   ```php
   Route::get('/posts', \App\Livewire\Admin\Posts\PostIndex::class)->name('admin.posts.index');
   ```

Table styling: White bg, rounded, shadow, hover states on rows. Use Tailwind.
  </action>
  <verify>
    php artisan livewire:list | grep PostIndex
    php artisan route:list --path=admin/posts
  </verify>
  <done>
    - PostIndex lists all posts with pagination
    - Search filters by title
    - Status filter works
    - Delete with confirmation works
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PostCreate and PostEdit components</name>
  <files>
    app/Livewire/Admin/Posts/PostCreate.php
    resources/views/livewire/admin/posts/post-create.blade.php
    app/Livewire/Admin/Posts/PostEdit.php
    resources/views/livewire/admin/posts/post-edit.blade.php
    routes/web.php
  </files>
  <action>
1. Create PostCreate component:
   - Public properties: $title, $slug, $content, $excerpt, $status = 'draft', $selectedCategories = [], $selectedTags = []
   - Validation rules: title required|max:255, slug required|unique:posts|max:255, content required, status in:draft,published
   - updatedTitle() auto-generates slug using Str::slug() if slug is empty
   - save() method: creates Post, syncs categories/tags, redirects to index with success message
   - render() passes Category::all() and Tag::all() for multi-select

2. Create PostEdit component:
   - Same properties as PostCreate, plus $post (Post model via mount)
   - mount(Post $post) populates all properties from model
   - Validation: slug unique rule excludes current post ID
   - update() method: updates post, syncs relationships, redirects with success
   - Can change status between draft/published (sets published_at appropriately)

3. Create views for both:
   - Form layout with card styling
   - Title input (wire:model)
   - Slug input (wire:model, with hint about auto-generation)
   - Content textarea (wire:model) - simple textarea for now (Phase 6 keeps it simple, rich text is a "nice to have")
   - Excerpt textarea (optional)
   - Status select (Draft/Published)
   - Category multi-select checkboxes
   - Tag multi-select checkboxes
   - Save/Cancel buttons
   - Validation error display using @error

4. Add routes:
   ```php
   Route::get('/posts/create', \App\Livewire\Admin\Posts\PostCreate::class)->name('admin.posts.create');
   Route::get('/posts/{post}/edit', \App\Livewire\Admin\Posts\PostEdit::class)->name('admin.posts.edit');
   ```

Note: User wants simplicity. Use basic textarea for content - no fancy rich text editor needed for MVP. Content already has HTML from WordPress migration.
  </action>
  <verify>
    php artisan livewire:list | grep -E "PostCreate|PostEdit"
    php artisan route:list --path=admin/posts
  </verify>
  <done>
    - PostCreate renders form and saves new posts
    - PostEdit loads existing post and saves changes
    - Category and tag selection works
    - Validation errors display correctly
    - Publishing sets published_at timestamp
  </done>
</task>

</tasks>

<verification>
- [ ] /admin/posts shows paginated list of all posts
- [ ] Search filters posts by title
- [ ] Status filter shows only published/draft
- [ ] "New Post" links to create form
- [ ] Create form saves new post to database
- [ ] Edit form loads existing post data
- [ ] Save on edit updates post in database
- [ ] Category/tag selection persists correctly
- [ ] Delete removes post after confirmation
- [ ] Validation errors display on invalid input
</verification>

<success_criteria>
1. Admin can view all posts in paginated table
2. Admin can search and filter posts
3. Admin can create new post with title, content, categories, tags
4. Admin can edit existing post
5. Admin can change post status (draft/published)
6. Admin can delete post with confirmation dialog
7. All actions show appropriate success messages
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-panel/06-03-SUMMARY.md`
</output>
