---
phase: 08-design-foundation
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - resources/views/components/layout.blade.php
autonomous: false

must_haves:
  truths:
    - "The site looks and functions identically to its current state (no visual regressions)"
    - "Body text renders in Inter, not the previous Instrument Sans or system default"
    - "FOUC prevention script still works (no flash of wrong theme on load)"
    - "Dark mode toggle still functions correctly"
  artifacts:
    - path: "resources/views/components/layout.blade.php"
      provides: "Layout with font preloads and semantic token body classes"
      contains: "font-body"
  key_links:
    - from: "resources/views/components/layout.blade.php"
      to: "resources/css/app.css"
      via: "@vite directive loads compiled CSS with tokens"
      pattern: "@vite"
    - from: "resources/views/components/layout.blade.php"
      to: "public/fonts/*.woff2"
      via: "link rel=preload for critical fonts"
      pattern: "preload.*fonts/"
---

<objective>
Update the main layout to preload critical fonts and migrate body classes to semantic tokens, then verify the complete design foundation works with no visual regressions.

Purpose: Fonts need preload hints in the HTML head for fastest loading. The body element currently uses hardcoded Tailwind classes (bg-white, dark:bg-slate-900, text-gray-900, dark:text-slate-100) that must migrate to semantic tokens. Finally, human verification confirms no regressions.

Output: Updated layout.blade.php with font preloads and semantic body classes, plus human-verified visual correctness.
</objective>

<execution_context>
@/Users/shoemoney/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shoemoney/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-design-foundation/08-RESEARCH.md
@.planning/phases/08-design-foundation/08-01-SUMMARY.md
@resources/views/components/layout.blade.php
@resources/css/app.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update layout with font preloads and semantic body classes</name>
  <files>resources/views/components/layout.blade.php</files>
  <action>
Modify resources/views/components/layout.blade.php with these specific changes:

1. **Add font preload links** in the `<head>` section, AFTER the FOUC prevention script and BEFORE the `<meta charset>` tag. Add these three lines:
```html
<link rel="preload" href="/fonts/inter-variable.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/space-grotesk-variable.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/jetbrains-mono-variable.woff2" as="font" type="font/woff2" crossorigin>
```
The `crossorigin` attribute is required for font preloads even for same-origin fonts (browser spec requirement).

Only preload Inter and Space Grotesk if you want to minimize preloads (they are critical path). JetBrains Mono is optional since code blocks appear below the fold. But including all three is fine for a blog with relatively few resources.

2. **Migrate body classes** from hardcoded colors to semantic tokens. Change the `<body>` tag from:
```html
<body class="bg-white dark:bg-slate-900 text-gray-900 dark:text-slate-100 antialiased min-h-screen flex flex-col transition-colors duration-200">
```
To:
```html
<body class="bg-surface-page text-text-primary font-body antialiased min-h-screen flex flex-col transition-colors duration-200">
```

Key changes:
- `bg-white dark:bg-slate-900` becomes `bg-surface-page` (semantic token handles both modes)
- `text-gray-900 dark:text-slate-100` becomes `text-text-primary` (semantic token handles both modes)
- Added `font-body` to explicitly set the Inter font stack on the body element
- Removed all `dark:` prefixed classes -- semantic tokens handle dark mode automatically via CSS custom property overrides

3. **Keep everything else unchanged:** The FOUC prevention script, Alpine.js x-data/x-init/:class attributes on `<html>`, @vite directive, @livewireStyles/@livewireScripts, Setting::getValue calls, navigation, footer, sidebar logic -- all stay exactly as they are.

**Do NOT change:** Any other blade template files in this task. Only layout.blade.php.
  </action>
  <verify>
Run: `npm run build` -- must succeed.
Run: `grep 'preload.*fonts/' resources/views/components/layout.blade.php` -- should show 3 preload links.
Run: `grep 'bg-surface-page' resources/views/components/layout.blade.php` -- should match.
Run: `grep 'bg-white' resources/views/components/layout.blade.php` -- should NOT match on the body tag.
Run: `grep 'font-body' resources/views/components/layout.blade.php` -- should match on body tag.
  </verify>
  <done>layout.blade.php has font preload links for all 3 fonts, body uses semantic token classes (bg-surface-page, text-text-primary, font-body) with no hardcoded color classes or dark: prefixes on the body element, and Vite build succeeds.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual regression check</name>
  <what-built>
Complete design token system: self-hosted variable fonts (Space Grotesk, Inter, JetBrains Mono), two-layer semantic color tokens with dark mode overrides, font preloads, and semantic body classes replacing hardcoded Tailwind utilities.
  </what-built>
  <how-to-verify>
1. Start the dev server: `php artisan serve` (if not already running)
2. Visit http://localhost:8000 in your browser
3. Check these specific things:

**Font verification:**
- Open DevTools > Elements, inspect any body text. Computed font-family should show "Inter Variable" (not "Instrument Sans" or system font)
- Inspect a heading if one is visible. Font-family should be available as font-display utility
- Check DevTools > Network tab, filter by Font -- should see 3 woff2 files loaded

**Light mode check:**
- Page background should look the same as before (light gray/white)
- Text should be dark and readable
- No broken layouts, no missing styles
- Navigate to a post page, category page, and admin page

**Dark mode check:**
- Toggle dark mode (use existing dark mode toggle or add .dark class to html element in DevTools)
- Background should be dark, text should be light
- No white-on-white or dark-on-dark text anywhere
- WordPress content (.wp-caption, .wp-more) should look correct in both modes

**Performance check:**
- Page should load without visible font swap flash (Inter should appear almost immediately due to preload + fallback)
- No console errors related to fonts or CSS

**Specific regression points:**
- Navigation still renders correctly
- Sidebar widgets display properly
- Footer looks normal
- Search bar functions
  </how-to-verify>
  <resume-signal>Type "approved" if site looks correct in both light and dark modes with new fonts loading, or describe any visual issues you see.</resume-signal>
</task>

</tasks>

<verification>
1. Font preload links present in layout.blade.php head
2. Body element uses semantic token classes, no hardcoded colors
3. Build succeeds
4. Human confirms visual correctness in both light and dark modes
</verification>

<success_criteria>
- Layout.blade.php uses semantic tokens on body (bg-surface-page, text-text-primary)
- Font preload links present for all 3 variable fonts
- No visual regressions confirmed by human inspection
- Dark mode toggle still works correctly
- Fonts render correctly (Inter for body text visible in DevTools)
</success_criteria>

<output>
After completion, create `.planning/phases/08-design-foundation/08-02-SUMMARY.md`
</output>
